<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHAT</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        body { background: #0f172a; color: #fff; font-family: 'Roboto', sans-serif; margin: 0; padding: 0; padding-bottom: 80px; display:flex; flex-direction:column; height:100vh; }
        #chatContainer { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 8px 12px; border-radius: 10px; max-width: 75%; font-size: 12px; }
        .left { align-self: flex-start; background: #334155; }
        .right { align-self: flex-end; background: #059669; }
        .input-area { background: #1e293b; padding: 10px; display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border-radius: 20px; border: none; background: #0f172a; color: #fff; }
        button { background: #f43f5e; color: #fff; border: none; width: 40px; border-radius: 50%; cursor: pointer; }
        .bottom-nav { background: #1e293b; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #334155; }
        .nav-item { color: #64748b; font-size: 9px; text-decoration: none; display: flex; flex-direction: column; align-items: center; width: 20%; }
        .nav-item.active { color: #f43f5e; font-weight: bold; }
        svg { width: 20px; height: 20px; fill: currentColor; }
    </style>
</head>
<body>

    <div id="chatContainer"></div>
    <div class="input-area">
        <input type="text" id="msgInput" placeholder="Pesan...">
        <button onclick="send()">âž¤</button>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</a>
        <a href="history.html" class="nav-item"><svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>History</a>
        <a href="wallet.html" class="nav-item"><svg viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>Wallet</a>
        <a href="chat.html" class="nav-item active"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/></svg>Chat</a>
        <a href="profile.html" class="nav-item"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>Profil</a>
    </nav>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDQ6jBWPxaItR4LntBwdviM5BAGxhd2N7Q", authDomain: "vipotpsystem.firebaseapp.com", databaseURL: "https://vipotpsystem-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "vipotpsystem", storageBucket: "vipotpsystem.firebasestorage.app", messagingSenderId: "1041472357696", appId: "1:1041472357696:web:d3070f47a3c263657da6a5" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const user = JSON.parse(localStorage.getItem('TASIK_SPLIT_PROF'));
        const box = document.getElementById('chatContainer');

        db.ref('system/chat').limitToLast(30).on('child_added', s => {
            const d = s.val();
            const cls = d.user === user.name ? 'right' : 'left';
            const div = document.createElement('div'); div.className = `bubble ${cls}`;
            div.innerHTML = `<b>${d.user}</b><br>${d.msg}`;
            box.appendChild(div); box.scrollTop = box.scrollHeight;
        });

        function send() {
            const i = document.getElementById('msgInput'); const t = i.value.trim();
            if(t) {
                db.ref('system/chat').push({user:user.name, msg:t, time:Date.now()});
                i.value="";
            }
        }
    </script>
</body>
</html>
